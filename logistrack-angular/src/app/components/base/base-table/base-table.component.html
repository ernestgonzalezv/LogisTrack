<div class="relative p-6 bg-gray-50 min-h-screen font-sans">

  <!-- Overlay de carga -->
  <div
    *ngIf="isLoading"
    class="absolute inset-0 bg-white/70 backdrop-blur-sm flex items-center justify-center z-50"
  >
    <div class="flex flex-col items-center gap-4">
      <svg class="animate-spin h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <span class="text-gray-700 font-medium">Cargando...</span>
    </div>
  </div>

  <div class="flex flex-col sm:flex-row sm:justify-end sm:items-end mb-6 gap-4">

    <div class="flex flex-wrap gap-4 justify-end">
      <div
        *ngFor="let key of extraFilterKeys()"
        class="bg-blue-100 text-blue-800 px-4 py-2 rounded-lg shadow hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 flex items-center gap-2"
      >
        <span class="font-semibold capitalize">{{ key.replace('_', ' ') }}:</span>
        <input
          type="text"
          [(ngModel)]="extraFilters[key]"
          placeholder="Filtrar..."
          class="px-2 py-1 border border-blue-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 transition"
        />
      </div>
    </div>

    <div class="flex justify-end">
      <button
        class="px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600 transition shadow"
        (click)="applyExtraFilters()"
      >
        Buscar
      </button>
    </div>

  </div>

  <div class="overflow-x-auto shadow-lg rounded-lg bg-white p-4 mb-6">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-blue-50">
      <tr>
        <th
          *ngFor="let col of displayedColumns"
          class="px-4 py-3 text-left text-sm font-medium text-gray-700 uppercase tracking-wider select-none"
        >
          {{ col | titlecase }}
        </th>
      </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
      <tr *ngFor="let row of data" class="hover:bg-blue-50 transition">
        <td *ngFor="let col of displayedColumns">
          {{ getNestedValue(row, col) }}
        </td>
      </tr>
      <tr *ngIf="data.length === 0">
        <td [attr.colspan]="displayedColumns.length" class="text-center px-4 py-6 text-gray-400">
          No se encontraron resultados
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="flex justify-end items-center mt-4 gap-2">
    <button
      class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition"
      (click)="onPageChange({ pageIndex: pageIndex - 1, pageSize: pageSize, length: totalCount })"
      [disabled]="pageIndex === 0"
    >
      Anterior
    </button>

    <span class="px-4 py-2 bg-white border rounded-lg shadow-sm text-gray-700 font-medium">
      {{ pageIndex + 1 }}
    </span>

    <button
      class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition"
      (click)="onPageChange({ pageIndex: pageIndex + 1, pageSize: pageSize, length: totalCount })"
      [disabled]="(pageIndex + 1) * pageSize >= totalCount"
    >
      Siguiente
    </button>
  </div>
</div>
